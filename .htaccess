# Gzip Compression Configuration - Performance Optimization Point 9
# Enable compression for text-based files to reduce file size by 15-25%
# Works on Apache and compatible servers

<IfModule mod_deflate.c>
    # Compress HTML, CSS, JavaScript, JSON, XML, TXT
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/rss+xml

    # Compress common web font and image file types
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/x-shockwave-flash

    # Set compression level (1-9, 9=maximum compression)
    # 6 is good balance of compression vs CPU usage
    DeflateCompressionLevel 6

    # Ensure proper content-length headers are set
    BrowserMatch ^Mozilla/4 gzip-only-text/(1|4)
    BrowserMatch ^MSIE [6-7] gzip-only-text/1
    BrowserMatch \bMSIE [1-5]\b !gzip-only-text/[1-6]

    # Exclude already compressed files
    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png|zip|webp)$ no-gzip dont-vary
    SetEnvIfNoCase Request_URI .(?:js|css|html)$ no-gzip dont-vary

    # Vary header for proper caching
    Header append Vary: Accept-Encoding
</IfModule>

# Caching Configuration for Static Assets
# Cache static resources for faster repeat visits
<IfModule mod_expires.c>
    # Cache CSS, JS, images for 1 year
    <FilesMatch ".(css|js|ico|png|jpg|jpeg|gif|webp|svg|woff|woff2)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
        ExpiresByType text/css "access plus 1 year"
        ExpiresByType application/javascript "access plus 1 year"
        ExpiresByType image/x-icon "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/webp "access plus 1 year"
        ExpiresByType image/svg "access plus 1 year"
        ExpiresByType font/woff "access plus 1 year"
        ExpiresByType font/woff2 "access plus 1 year"
    </FilesMatch>

    # HTML files
    <FilesMatch "\.html$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
    </FilesMatch>
</IfModule>

# Security Headers
# Add security headers for additional protection and performance
<IfModule mod_headers.c>
    # Prevent clickjacking
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options SAMEORIGIN
    Header always set X-XSS-Protection "1; mode=block"

    # Add cache control headers
    Header always set Cache-Control "public, max-age=31536000"

    # Remove server signature
    ServerSignature Off
</IfModule>

# Performance Headers
# Additional headers for performance optimization
<IfModule mod_headers.c>
    # Enable Keep-Alive for persistent connections
    Header set Connection keep-alive

    # Add ETag for efficient caching
    FileETag MTime Size

    # Enable HTTP/2 if available
    # Header always set Upgrade h2c,http/2.0
</IfModule>

# Error Handling
# Custom error pages for better user experience
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# Directory Indexing
# Prevent directory listing and protect sensitive files
Options -Indexes
Options -FollowSymLinks

# Redirect WWW to non-WWW
# Ensure consistent URL structure
RewriteEngine On
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]